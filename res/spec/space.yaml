- verbs:
  - goto
  - talkto
  - use
  - lookat

- name: Space Adventure

- state: talked to crew member
- state: weapons active
- state: red alert
- state: seen symbol
- state: bob dead
- state: haircut done
- state: escape sequence

- start: command deck

#
# Ship
#

- location: command deck
  description:
  - You are standing on the command deck of your spaceship, as befits a captain like you.
    There is a door to your [quarters] behind you.
  - if-not-state: talked to crew member
    then:
      You are on a routine mission to transport passengers to a distant planet.
  - if-state: escape sequence
    then:
      The voice of the computer helpfully informs you that your fuel is at 5% and that you
      should head to the nearest spaceship fuel station.

- location: quarters
  name: personal captain's quarters
  description:
  - Ah, your personal quarters. You always withdraw here when things heat up out on the [command deck].
  - There is a [bed] here, and a shelf where you keep your [souvenirs] from the space academy.
  - There is even a small [window].

- thing: souvenirs
  use: They are souvenirs, not really useful for anything. But they make you feel like a captain.
  lookat-use: souvenirs

- thing: bed
  goto-use: bed
  use:
    Ah... You lie down on the bed. You relax a little, but the thought about space command
    calling you to check on your mission makes you nervous.
  lookat:
    You have kept the duvet from you childhood room. It has stars, planets and rockets in
    a comforting pattern.

- thing: window
  use:
    You often have the urge to jump out this window. But today is not the day.
  lookat:
    Ah, a window. You have made it. Not everyone gets to have a room with a window in space.

- thing: personal screen
  location: command deck
  exists-state: talked to crew member
  description:
  - if-state: escape sequence
    then-return:
      Your [personal screen] in front of you displays a map of a strange solar system
      that you don't recognize.
  - if-state: weapons active
    then-return:
      A light on your [personal screen] blinks worrying.
      There is a little weapons icon with a circle around it.
  - if-state: talked to crew member
    then-return: A light on your *personal screen* blinks worrying.

  lookat:
  - use: personal screen

  pickup:
  - fail: It is firmly attached.

  use:
  - if-state: escape sequence
    then-return-spawn: planet choice
  - if-not-state: talked to crew member
    then: It glows calm and blue.
    else-spawn: command choices

  talkto:
    This story takes place in the distant future, when humanity has finally
    realized that Alexa was a bad idea. We generally interact with computers
    by pressing buttons.

- thing: crew member
  location: command deck
  description: 
  - if-not-state: talked to crew member
    then: A *crew member* suddenly approaches, flailing her arms.
    else: The *crew member* looks to you for firm leadership.

  pickup:
  - fail: Doesn't make sense

  use:
  - fail: Doesn't make sense

  lookat:
  - if-state: talked to crew member
    then: The crew member looks horrified.
    else: The crew member looks like she has something important to tell you.

  talkto:
  - if-not-state: talked to crew member
    then:
    - set: talked to crew member
    - seq:
      - 'The crew member announces: "Another ship is approaching."'
      - Hardly has she had time to say that, when your ship shakes and the lights blink.
        "We have been shot!" Suddenly, your mission to transport passengers to a distant
        planet takes a different turn.
    else:
      'She says: "Do something captain!!!"'

#
# Choices
#

- choice: command choices
  description:
    The AI system of the ship has conveniently placed some typical options for this situation
    on your personal screen.
  alternatives:
  - label: Red alert
    exists-not-state: red alert
    do:
    - set: red alert
    - A monotonous voice starts repeatedly announcing that a red alert has been declared.
      Blinking red lights appear. The crew starts hustling and bustling around computers. Your
      first officer says something, but you can’t hear it over the computerised alert
      announcement.

  - label: Cancel red alert
    exists-state: red alert
    do:
    - reset: red alert
    - >
      The voice stops. The lights return to normal. Your first officer says:
      "Thanks. I couldn’t hear the music on my headphones over that."

  - label: Take power from the shields for weapons
    exists-not-state: weapons active
    do:
    - set: weapons active
    - Your screen announces that the shields are now at 60% and that the weapons are ready.

  - label: Activate weapons
    exists-state: weapons active
    do-seq:
    - You can see strays of light shooting from your ship towards the enemy spaceship, which
      is still too far to be seen.
    - You don't have time to see if the weapons hit their target though, before another impact
      shakes your ship.
    - Life support systems are down! The first officer announces, and that’s the last thing you
      hear.

  - label: Disable weapons
    exists-state: weapons active
    do:
    - reset: weapons active
    - Your screen announces that the shields are now at 100%

  - label: Activate escape sequence
    do:
    - set: escape sequence
    - >
      The computer announces: "Escape sequence activated!"
      You feel a sharp jolt and the scenery outside the ship becomes filled with blurry white
      lines.
      "We are doing a jump!" the first officer states. "I wonder where!"
      After only a few minutes, the white stripes outside turn into more star-like patterns.

- choice: planet choice
  description:
    The map of the solar system has two planets, numbered Planet 1 and Planet 2.

  alternatives:
  - label: Plot a course for planet 1
    do:
    - spawn: planet street
    - You and two of your crew members, Shirley and Bob, teleports to the
      surface of the planet.
  - label: Plot a coutse for planet 2

#
# Planet 1
#

- thing: shirley
  name: Shirley
  pickup-fail: Can't do that.

- thing: bob
  name: Bob
  pickup-fail: Can't do that.
  talkto:
  - if-in: planet garden
    then:
      if-state: haircut done
      then:
      - set: bob dead
      - seq:
          - You look at Bob,‭ ‬your officer in his red uniform,‭ ‬who shrugs and approaches the chair and the alien.‭ 
            ‬He sits on the chair and the green alien says something that sounds like‭ “‬GGGhhrrriijjk bloooob‭”‬.‭
            ‬You can hear‭ ‬Bob’s translation device automatically translating this to mean‭
            "‬Would you like a complete or superficial haircut,‭ ‬sir‭?"
          - Bob says:‭ "Oh,‭ ‬nice,‭ ‬a complete one please.‭ ‬My hair is very overgrown at the moment.‭"
          - The barber reaches for his‭ ‬box‭ ‬for what looks like a laser wand,‭ ‬and without ceremony cuts Bob’s head off with‭ ‬it,‭ ‬
            as his body is still left sitting on the‭ ‬chair.‭ ‬
            The alien seems a bit confused about the amount of blood spilled,‭ ‬and inspects its tool.
      else:
        Why don't you try the haircut, sir?
    else:
      Hello sir, I'm bob

  lookat-talkto: bob

#
# Planet 1 street
#

- location: planet street
  description: 
  - You appear in the middle of a busy street.
  - if-not-state: bob dead
    then: Your crew members [shirley] and [bob] is with you.
    else: Your crew member [shirley] is with you.
  - There is a high wall on both sides of the [planet upstreet] with only one closed door one your left.
    There is a [symbol] on the door, just above the [handle].
  - The street is full of strange [creatures], who are walking on both directions.

- thing: symbol
  pickup-fail: Can't pick it up.
  lookat:
  - set: seen symbol
  - seq:
    - Your portable translation device tells you that the symbol above the door handle stands
      for "barber shop". The creatures on the street don’t even look at you when they keep
      walking on.
    - As you examine the symbol you suddenly hear a mechanism click inside the door.

- thing: handle
  pickup-fail: Can't pick it up.
  use:
    - if-state: seen symbol
      then:
      - spawn: planet garden
      - As soon as you touch the handle, the door opens to an open garden.
      else:
      - Nothing happens, the door is firmly locked.

- thing: creatures
  lookat: They look a bit like humans but are green and constantly smiling.
  pickup-fail: Can't do that.
  talkto:
    They say "FFFhhrrriijjk bliiiib". Your translation device is unable to translate
    as it seems to be an unknown street slang.

#
# Planet 1 garden
#

- location: planet garden
  description:
  - The weather is sunny and pleasant and lizards are singing high up in the strange treetops.
  - There is a [chair] in the middle of the garden, and one of the green aliens is standing next
    to it in front of a big [box], smiling. 
  - if-not-state: bob dead
    then: '[bob] standing next to you, while Shirley stayed outside, waiting.'
    else: "The aliens are curiously investigating Bob's corpse. Shirley is stayed outside, waiting."
  - There is a [garden door] leading back to the street.

- thing: chair
  use-spawn: haircut
  goto-use: chair
  lookat:
  - It looks like a hairdressers chair, but slightly alien.

- thing: holographic key
  lookat:
  - It looks like a key
  pickup: true
  use:
  - if-in: planet upstreet
    then-seq:
    - The key seem to fit in the big doors. They slowly open to reveal what's on the other side.
    - Suddenly you and Shirley are back inside your ship. The computer screen shows
      "Transport error. Reset performed."
    - spawn: command deck
    else:
      It doesn't seem to be usable here.

- thing: box
  use-lookat: box
  goto-lookat: box
  lookat:
    seq:
    - You approach the box, which is open from the top, and see that it’s full of strange
      looking tools.
    - if-state: bob dead
      then:
      - pickup: holographic key
      - As the aliens discuss what happened with Bob's head, you manage to find a holographic key
        at the bottom of the box.
      else: You try to examine it more closely, but the creatures look at you suspiciously.

- thing: garden door
  goto-spawn: planet street
  use-spawn: planet street
  name: door

- choice: haircut
  description:
    You sit on the chair, and the green alien says something that sounds like "GGGhhrrriijjk
    bloooob". Your translation device automatically translates this to mean 
    "Would you like a complete or superficial haircut, sir?"
  alternatives:
  - label: Complete
    do-die: 
      The barber alien reaches for the box and takes out a tool that looks like a laser wand.
      You feel a sharp pain on your neck and see nothing more.
  - label: Superficial
    do:
    - set: haircut done
    - The barber alien reaches for the box and takes out a pair of very ordinary looking
      scissors. After completing your haircut he holds out a mirror, and you can see that it’s a
      very nice haircut indeed.

# planet 1 up the street

- location: planet upstreet
  name: street
  description:
  - You walk down the street which continues the same for a long time,‭ ‬just like‭ ‬[where you came from],‭ ‬until it ends to a building.‭ 
  - There are‭ ‬[big doors] through which the‭ ‬green‭ ‬aliens walk in and out of the building,‭ ‬constantly smiling.

- thing: big doors
  lookat:
  - When you reach the doors,‭ ‬you see that although there is a gap between them,‭ ‬you can’t see through it to the‭ ‬other side.‭ 
    The creatures who walk out from it and continue‭ ‬up the street seem to be emerging through a wall.
  use:
  - They are firmly locked.
  goto-use: big doors

- thing: where you came from
  goto-spawn: planet street
  lookat: Looking back to the place where you came from, you just see the amiling aliens walking around.